<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crushers Cafe | Premium Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #F59E0B; --zomato-red: #E23744; --dark-bg: #0F172A; --card-bg: #1E293B; --sidebar-bg: #020617; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--dark-bg); color: white; overflow: hidden; }

        /* Modern Header */
        header { background: var(--sidebar-bg); padding: 15px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); height: 70px; display: flex; align-items: center; justify-content: center; }
        header h1 { color: var(--zomato-red); letter-spacing: 1px; text-transform: uppercase; font-size: 20px; font-weight: 800; }

        /* Vertical Sidebar Layout */
        .wrapper { display: flex; height: calc(100vh - 130px); }
        .sidebar { width: 90px; background: var(--sidebar-bg); border-right: 1px solid rgba(255,255,255,0.05); overflow-y: auto; scrollbar-width: none; }
        .sidebar::-webkit-scrollbar { display: none; }
        
        .cat-btn { padding: 15px 5px; color: #94A3B8; text-align: center; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 10px; text-transform: uppercase; transition: 0.3s; font-weight: 500; }
        .cat-btn.active { color: #fff; background: var(--zomato-red); font-weight: bold; border-right: 4px solid var(--gold); }

        /* Content Area */
        .content { flex: 1; padding: 15px; overflow-y: auto; background: var(--dark-bg); scroll-behavior: smooth; }
        .subcat-header { width: 100%; color: var(--gold); font-size: 13px; font-weight: 600; margin: 10px 0 15px 0; border-left: 3px solid var(--zomato-red); padding-left: 10px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Glassmorphism Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 30px; }
        .card { background: var(--card-bg); padding: 10px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; position: relative; }
        .card:active { transform: scale(0.96); }
        .card img { width: 100%; height: 100px; object-fit: cover; border-radius: 12px; margin-bottom: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .card h4 { text-transform: capitalize; font-size: 13px; margin-bottom: 4px; color: #F8FAFC; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card p { color: var(--gold); font-weight: 700; font-size: 14px; margin-bottom: 10px; }

        /* Out of Stock Style */
        .sold-out { opacity: 0.5; filter: grayscale(1); pointer-events: none; }
        .sold-out::after { content: "SOLD OUT"; position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); background: var(--zomato-red); color: white; padding: 2px 8px; font-size: 10px; font-weight: 800; border-radius: 4px; }

        /* Qty Controls */
        .qty-box { display: flex; justify-content: center; align-items: center; gap: 12px; background: rgba(0,0,0,0.2); border-radius: 50px; padding: 4px; }
        .btn-q { background: var(--zomato-red); border: none; width: 26px; height: 26px; border-radius: 50%; cursor: pointer; font-weight: bold; color: white; font-size: 16px; }

        /* Footer Cart */
        footer { position: fixed; bottom: 0; width: 100%; height: 65px; background: var(--sidebar-bg); border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; padding: 0 20px; align-items: center; z-index: 500; box-shadow: 0 -10px 25px rgba(0,0,0,0.5); }
        .order-btn { background: var(--zomato-red); color: white; border: none; padding: 12px 25px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 14px; box-shadow: 0 4px 15px rgba(226, 55, 68, 0.3); }

        /* Overlay & Modal */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal { background: var(--card-bg); padding: 25px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); width: 90%; max-width: 380px; text-align: center; }
        input { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: 1px solid #334155; background: #0F172A; color: #fff; outline: none; }

        /* Loader */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 3000; }
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--zomato-red); border-radius: 50%; width: 45px; height: 45px; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="color:var(--zomato-red); font-size: 11px; letter-spacing: 2px; margin-top: 15px; font-weight: 600;">CRUSHERS CAFE</p>
    </div>

    <header><h1>CRUSHERS CAFE</h1></header>

    <div class="wrapper">
        <aside class="sidebar" id="sidebar"></aside>
        <main class="content" id="menuArea"></main>
    </div>

    <footer>
        <div>
            <p style="font-size: 10px; color: #94A3B8;">Total Amount</p>
            <div id="totalBill" style="font-weight: 700; color: var(--gold); font-size: 18px;">₹0</div>
        </div>
        <button class="order-btn" onclick="openModal()">Place Order</button>
    </footer>

    <div id="customerModal" class="overlay">
        <div class="modal">
            <h2 style="color:var(--zomato-red); margin-bottom: 5px;">Order Details</h2>
            <p style="color: #94A3B8; font-size: 12px; margin-bottom: 20px;">Enter details to send on WhatsApp</p>
            <input type="text" id="custName" placeholder="Your Name">
            <input type="tel" id="custPhone" placeholder="Mobile Number">
            <button class="order-btn" style="width:100%; margin-top: 15px; padding: 15px;" onclick="finalWhatsApp()">CONFIRM ORDER</button>
            <p onclick="document.getElementById('customerModal').style.display='none'" style="margin-top: 20px; cursor:pointer; font-size: 13px; color: #94A3B8;">Maybe later</p>
        </div>
    </div>

    <script>
        // API_URL: Use your Google Apps Script URL here for instant updates
        const API_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRbqnHX8ZIy7DTi2Zch413BxwX_7gCJerCPiFSHsgI83UTyOH137c2sMQJcKqelxFaPSvEGiN7oapwk/pub?gid=0&single=true&output=csv";

        let fullMenu = [];
        let categories = [];
        let cartItems = {};
        let grandTotal = 0;

        async function startApp() {
            try {
                const response = await fetch(API_URL + '&v=' + Date.now());
                const csvData = await response.text();
                processCSV(csvData);
                document.getElementById('loader').style.display = 'none';
            } catch (err) { console.error("Menu Load Error"); }
        }

        function processCSV(csv) {
            const rows = csv.split("\n").slice(1);
            fullMenu = rows.map(row => {
                const cols = row.split(",");
                if(cols.length >= 4) {
                    let rawName = cols[0].trim();
                    return {
                        name: rawName.charAt(0).toUpperCase() + rawName.slice(1).toLowerCase(),
                        price: parseInt(cols[1]) || 0,
                        category: cols[2].trim().toLowerCase(),
                        subcategory: cols[3].trim().toLowerCase(),
                        img: (cols[4] && cols[4].trim()) || 'https://via.placeholder.com/150'
                    };
                }
            }).filter(item => item);

            categories = ['all', ...new Set(fullMenu.map(item => item.category))];
            createSidebar();
            render('all');
        }

        function createSidebar() {
            const sb = document.getElementById('sidebar');
            sb.innerHTML = "";
            categories.forEach(cat => {
                let activeClass = cat === 'all' ? 'active' : '';
                sb.innerHTML += `<div class="cat-btn ${activeClass}" onclick="render('${cat}', this)">${cat}</div>`;
            });
        }

        function render(category, btn = null) {
            if(btn) {
                document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            
            const area = document.getElementById('menuArea');
            area.innerHTML = "";
            let filtered = category === 'all' ? fullMenu : fullMenu.filter(i => i.category === category);
            
            let grouped = filtered.reduce((acc, obj) => {
                let key = obj.subcategory || "Other";
                if (!acc[key]) acc[key] = [];
                acc[key].push(obj);
                return acc;
            }, {});

            for (let subcat in grouped) {
                area.innerHTML += `<div class="subcat-header">${subcat}</div>`;
                let grid = document.createElement('div');
                grid.className = "grid";
                
                grouped[subcat].forEach(item => {
                    const cleanId = item.name.replace(/\s+/g, '-');
                    const isSoldOut = item.price === 0 ? 'sold-out' : '';
                    
                    grid.innerHTML += `
                        <div class="card ${isSoldOut}">
                            <img src="${item.img}" onerror="this.src='https://via.placeholder.com/150'">
                            <h4>${item.name}</h4>
                            <p>₹${item.price}</p>
                            <div class="qty-box">
                                <button class="btn-q" onclick="changeQty('${item.name}', -1, ${item.price})">−</button>
                                <span id="q-${cleanId}" style="font-weight:600; font-size:14px; min-width:20px;">${cartItems[item.name] || 0}</span>
                                <button class="btn-q" onclick="changeQty('${item.name}', 1, ${item.price})">+</button>
                            </div>
                        </div>`;
                });
                area.appendChild(grid);
            }
        }

        function changeQty(name, delta, price) {
            if(price === 0) return;
            if(!cartItems[name]) cartItems[name] = 0;
            if(cartItems[name] + delta >= 0) {
                cartItems[name] += delta;
                grandTotal += (delta * price);
                document.getElementById(`q-${name.replace(/\s+/g, '-')}`).innerText = cartItems[name];
                document.getElementById('totalBill').innerText = "₹" + grandTotal;
            }
        }

        function openModal() {
            if(grandTotal === 0) return alert("Pehle kuch swadisht select karein!");
            document.getElementById('customerModal').style.display = 'flex';
        }

        function finalWhatsApp() {
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            if(!name || !phone) return alert("Details bharna zaroori hai!");

            let msg = `*CRUSHERS CAFE NEW ORDER*%0A--------------------------%0A*Customer:* ${name}%0A*Phone:* ${phone}%0A%0A*ORDER ITEMS:*%0A`;
            for(let key in cartItems) {
                if(cartItems[key] > 0) msg += `✅ ${key} x ${cartItems[key]}%0A`;
            }
            msg += `%0A*TOTAL BILL: ₹${grandTotal}*%0A--------------------------%0APlease confirm our order!`;
            window.location.href = `https://wa.me/919876543210?text=${msg}`;
        }

        // --- GHOST REFRESH TRICK (Checks every 60s) ---
        setInterval(async () => {
            try {
                const response = await fetch(API_URL + '&v=' + Date.now());
                const csvData = await response.text();
                processCSV(csvData);
                console.log("Menu auto-synced with Excel");
            } catch (e) { console.log("Auto-sync failed"); }
        }, 60000);

        window.onload = startApp;
    </script>
</body>
</html>
